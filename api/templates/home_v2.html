{% extends 'base.html' %}
{% load static %}

{% block title %}Ask For Data | Plateforme Intelligente de Données Ivoiriennes{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home-v2.css' %}?v=2.2">
{% endblock %}

{% block content %}
<!-- ============================================
     HERO SECTION - Immersive & Modern
     ============================================ -->
<section class="hero-v2">
    <!-- Multi-Layer Parallax Background -->
    <div class="hero-bg">
        <!-- Layer 1: Gradient Orbs -->
        <div class="parallax-layer" data-speed="0.1">
            <div class="gradient-orb orb-1"></div>
            <div class="gradient-orb orb-2"></div>
            <div class="gradient-orb orb-3"></div>
            <div class="gradient-orb orb-4"></div>
        </div>
        
        <!-- Layer 2: Floating Shapes -->
        <div class="parallax-layer" data-speed="0.2">
            <div class="floating-shape shape-1"></div>
            <div class="floating-shape shape-2"></div>
            <div class="floating-shape shape-3"></div>
            <div class="floating-shape shape-4"></div>
            <div class="floating-shape shape-5"></div>
        </div>
        
        <!-- Layer 3: Geometric Lines -->
        <div class="parallax-layer" data-speed="0.05">
            <div class="geo-line line-1"></div>
            <div class="geo-line line-2"></div>
            <div class="geo-line line-3"></div>
        </div>
        
        <!-- Layer 4: Particles -->
        <div class="particles-container" id="particles">
            <!-- Generated by JS -->
        </div>
        
        <!-- Layer 5: Glass Panels -->
        <div class="glass-panel panel-1"></div>
        <div class="glass-panel panel-2"></div>
        <div class="glass-panel panel-3"></div>
        
        <!-- Mesh Pattern -->
        <div class="mesh-pattern"></div>
        
        <!-- Gradient Overlay -->
        <div class="gradient-overlay"></div>
    </div>

    <div class="hero-content">
        <!-- Logo -->
        <div style="margin-bottom: 1.5rem;">
            <img src="{% static 'img/logo.png' %}" alt="Ask For Data" style="height: 250px; width: auto;">
        </div>

        <!-- Badge -->
        <div class="hero-badge">
            <span class="badge-pulse"></span>
            <span class="badge-text">Plateforme IA • Côte d'Ivoire</span>
        </div>

        <!-- Main Title -->
        <h1 class="hero-title">
            <span class="title-line">Posez votre question,</span>
            <span class="title-accent">obtenez vos données.</span>
        </h1>

        <!-- Subtitle -->
        <p class="hero-subtitle">
            Accédez instantanément à plus de <strong>1 500 indicateurs</strong> sur la Côte d'Ivoire grâce à notre intelligence artificielle. Économie, population, santé, éducation — tout est à portée de question.
        </p>

        <!-- Search Container -->
        <div class="search-wrapper">
            <form id="search-form" class="search-form-v2">
                <div class="search-input-container">
                    <div class="search-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <input 
                        type="text" 
                        id="query-input" 
                        placeholder="Ex: Quel est le PIB de la Côte d'Ivoire en 2023 ?"
                        autocomplete="off"
                        required
                    >
                    <button type="submit" class="search-btn">
                        <span class="btn-text">Analyser</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </form>

            <!-- Quick Examples -->
            <div class="quick-examples">
                <span class="examples-label">Essayez :</span>
                <div class="examples-list">
                    <button type="button" class="example-chip" data-query="PIB 2020-2023">
                        <i class="fas fa-chart-line"></i> PIB 2020-2023
                    </button>
                    <button type="button" class="example-chip" data-query="Population totale">
                        <i class="fas fa-users"></i> Population
                    </button>
                    <button type="button" class="example-chip" data-query="Taux d'inflation 2023">
                        <i class="fas fa-percentage"></i> Inflation
                    </button>
                    <button type="button" class="example-chip" data-query="Accès à l'électricité">
                        <i class="fas fa-bolt"></i> Électricité
                    </button>
                    <button type="button" class="example-chip" data-query="Exportations de cacao">
                        <i class="fas fa-seedling"></i> Cacao
                    </button>
                </div>
            </div>

            <!-- Inline Loading State -->
            <div id="inline-loading" class="inline-loader" style="display: none;">
                <div class="loader-content">
                    <div class="loader-spinner">
                        <svg viewBox="0 0 50 50">
                            <circle cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle>
                        </svg>
                        <i class="fas fa-brain loader-icon"></i>
                    </div>
                    <div class="loader-text">
                        <span class="loader-title">Analyse en cours...</span>
                        <div class="loader-steps">
                            <span class="step active" data-step="1">Recherche</span>
                            <span class="step-separator">→</span>
                            <span class="step" data-step="2">Extraction</span>
                            <span class="step-separator">→</span>
                            <span class="step" data-step="3">Visualisation</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</section>

<!-- ============================================
     STATS SECTION - Key Numbers
     ============================================ -->
<section class="stats-section">
    <!-- Decorative Background -->
    <div class="section-bg">
        <div class="parallax-layer" data-speed="0.08">
            <div class="bg-shape bg-shape-1"></div>
            <div class="bg-shape bg-shape-2"></div>
        </div>
        <div class="section-gradient"></div>
    </div>
    <div class="stats-container">
        <div class="stat-card" data-aos="fade-up">
            <div class="stat-icon">
                <i class="fas fa-database"></i>
            </div>
            <div class="stat-value" data-count="+1592">0</div>
            <div class="stat-label">Indicateurs disponibles</div>
        </div>
        <div class="stat-card" data-aos="fade-up" data-aos-delay="100">
            <div class="stat-icon">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="stat-value" data-count="24">0</div>
            <div class="stat-label">Années de données</div>
        </div>
        <div class="stat-card" data-aos="fade-up" data-aos-delay="200">
            <div class="stat-icon">
                <i class="fas fa-layer-group"></i>
            </div>
            <div class="stat-value" data-count="12">0</div>
            <div class="stat-label">Secteurs couverts</div>
        </div>
        <div class="stat-card" data-aos="fade-up" data-aos-delay="300">
            <div class="stat-icon">
                <i class="fas fa-bolt"></i>
            </div>
            <div class="stat-value"><span data-count="5">0</span>s</div>
            <div class="stat-label">Temps de réponse moyen</div>
        </div>
    </div>
</section>

<!-- ============================================
     FEATURES SECTION - Bento Grid
     ============================================ -->
<section class="features-section" id="features">
    <!-- Decorative Background -->
    <div class="section-bg">
        <div class="parallax-layer" data-speed="0.06">
            <div class="floating-ring ring-1"></div>
            <div class="floating-ring ring-2"></div>
            <div class="floating-dot dot-1"></div>
            <div class="floating-dot dot-2"></div>
            <div class="floating-dot dot-3"></div>
        </div>
    </div>
    <div class="section-header">
        <span class="section-tag">Fonctionnalités</span>
        <h2 class="section-title">Une nouvelle façon d'accéder aux données</h2>
        <p class="section-desc">Conçu pour les décideurs, chercheurs, journalistes et citoyens</p>
    </div>

    <div class="bento-grid">
        <!-- Large Card - AI Search -->
        <div class="bento-card bento-large" data-aos="fade-up">
            <div class="bento-icon-wrap gradient-orange">
                <i class="fas fa-brain"></i>
            </div>
            <h3>Recherche par Langage Naturel</h3>
            <p>Posez vos questions comme à un expert. Notre IA comprend le contexte et trouve les données pertinentes.</p>
            <div class="bento-visual">
                <div class="mock-chat">
                    <div class="chat-bubble user">Quel est le taux de chômage des jeunes ?</div>
                    <div class="chat-bubble ai">
                        <i class="fas fa-robot"></i>
                        Le taux de chômage des jeunes (15-24 ans) était de 5.2% en 2022...
                    </div>
                </div>
            </div>
        </div>

        <!-- Medium Card - Visualization -->
        <div class="bento-card bento-medium" data-aos="fade-up" data-aos-delay="100">
            <div class="bento-icon-wrap gradient-green">
                <i class="fas fa-chart-area"></i>
            </div>
            <h3>Visualisations Interactives</h3>
            <p>Graphiques dynamiques générés automatiquement pour chaque requête.</p>
            <div class="mini-chart-preview">
                <svg viewBox="0 0 100 40">
                    <polyline fill="none" stroke="#22c55e" stroke-width="2" points="0,35 15,30 30,25 45,15 60,20 75,10 100,5"/>
                    <polyline fill="url(#gradient)" stroke="none" points="0,40 0,35 15,30 30,25 45,15 60,20 75,10 100,5 100,40"/>
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#22c55e;stop-opacity:0.3"/>
                            <stop offset="100%" style="stop-color:#22c55e;stop-opacity:0"/>
                        </linearGradient>
                    </defs>
                </svg>
            </div>
        </div>

        <!-- Small Card - Sources -->
        <div class="bento-card bento-small" data-aos="fade-up" data-aos-delay="150">
            <div class="bento-icon-wrap gradient-blue">
                <i class="fas fa-shield-alt"></i>
            </div>
            <h3>Sources Fiables</h3>
            <p>Banque Mondiale, ANStat, FMI...</p>
        </div>

        <!-- Small Card - Export -->
        <div class="bento-card bento-small" data-aos="fade-up" data-aos-delay="200">
            <div class="bento-icon-wrap gradient-purple">
                <i class="fas fa-download"></i>
            </div>
            <h3>Export Facile</h3>
            <p>Téléchargez en CSV, Excel</p>
        </div>

        <!-- Medium Card - Dashboard -->
        <div class="bento-card bento-medium" data-aos="fade-up" data-aos-delay="250">
            <div class="bento-icon-wrap gradient-orange">
                <i class="fas fa-th-large"></i>
            </div>
            <h3>Dashboard Thématique</h3>
            <p>Explorez 12 secteurs : économie, santé, éducation, environnement...</p>
            <div class="sector-pills">
                <span class="pill">Macro</span>
                <span class="pill">Finance</span>
                <span class="pill">Santé</span>
                <span class="pill">+9</span>
            </div>
        </div>

        <!-- Wide Card - Precision -->
        <div class="bento-card bento-wide" data-aos="fade-up" data-aos-delay="300">
            <div class="bento-icon-wrap gradient-red">
                <i class="fas fa-bullseye"></i>
            </div>
            <div class="bento-wide-content">
                <div>
                    <h3>Précision & Transparence</h3>
                    <p>Aucune donnée inventée. Chaque réponse inclut la source, l'unité de mesure et la méthodologie. Si l'information n'existe pas, l'IA vous le dit clairement.</p>
                </div>
                <div class="trust-badges">
                    <div class="trust-badge">
                        <i class="fas fa-check-circle"></i>
                        <span>Données vérifiées</span>
                    </div>
                    <div class="trust-badge">
                        <i class="fas fa-link"></i>
                        <span>Sources traçables</span>
                    </div>
                    <div class="trust-badge">
                        <i class="fas fa-clock"></i>
                        <span>Mise à jour régulière</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ============================================
     CTA SECTION - Call to Action
     ============================================ -->
<section class="cta-section">
    <!-- Parallax Background -->
    <div class="section-bg">
        <div class="cta-bg-shapes">
            <div class="cta-shape cta-shape-1"></div>
            <div class="cta-shape cta-shape-2"></div>
            <div class="cta-shape cta-shape-3"></div>
        </div>
    </div>
    <div class="cta-container">
        <!-- Inner Glow Effects -->
        <div class="cta-glow cta-glow-1"></div>
        <div class="cta-glow cta-glow-2"></div>
        <div class="cta-content">
            <h2>Prêt à explorer les données de la Côte d'Ivoire?</h2>
            <p>Commencez maintenant — c'est gratuit et instantané.</p>
            <a href="#" class="cta-btn" onclick="document.getElementById('query-input').focus(); window.scrollTo({top: 0, behavior: 'smooth'}); return false;">
                <span>Poser ma première question</span>
                <i class="fas fa-arrow-right"></i>
            </a>
        </div>
        <div class="cta-decoration">
            <div class="cta-circle"></div>
            <div class="cta-circle"></div>
            <div class="cta-circle"></div>
        </div>
    </div>
</section>

<!-- ============================================
     RESULTS SECTION (Initially Hidden)
     ============================================ -->
<section id="results-section" class="results-section" style="display: none;">
    <div class="results-container">
        <!-- Back Button -->
        <button class="back-btn" onclick="clearResults()">
            <i class="fas fa-arrow-left"></i>
            <span>Nouvelle recherche</span>
        </button>

        <!-- Result Header -->
        <div class="result-header">
            <h2 id="result-title">Analyse des Données</h2>
            <div class="result-meta">
                <span class="meta-tag" id="result-code"></span>
                <a id="result-source-link" href="#" target="_blank" rel="noopener noreferrer" class="source-link-btn" style="display:none;" onclick="event.stopPropagation();">
                    <i class="fas fa-external-link-alt"></i>
                    <span>Voir la source</span>
                </a>
            </div>
        </div>

        <!-- AI Response -->
        <div class="result-card ai-response-card">
            <div class="card-header">
                <i class="fas fa-robot"></i>
                <span>Réponse de l'IA</span>
                <div class="feedback-actions" id="feedback-actions">
                    <button type="button" class="feedback-btn feedback-positive" id="feedback-positive" title="Bonne réponse">
                        <i class="fas fa-thumbs-up"></i>
                    </button>
                    <button type="button" class="feedback-btn feedback-negative" id="feedback-negative" title="Mauvaise réponse — l'IA réanalysera">
                        <i class="fas fa-thumbs-down"></i>
                    </button>
                    <span class="feedback-message" id="feedback-message"></span>
                </div>
            </div>
            <div class="card-body">
                <p id="result-message"></p>
            </div>
        </div>

        <!-- Data Grid -->
        <div class="result-grid">
            <!-- Chart Card -->
            <div class="result-card chart-card">
                <div class="card-header">
                    <i class="fas fa-chart-line"></i>
                    <span>Visualisation</span>
                    <div class="card-header-actions">
                        <!-- Chart Type Selector -->
                        <div class="chart-type-selector">
                            <button type="button" class="chart-type-btn active" data-type="line" title="Courbe">
                                <i class="fas fa-chart-line"></i>
                            </button>
                            <button type="button" class="chart-type-btn" data-type="bar" title="Histogramme">
                                <i class="fas fa-chart-bar"></i>
                            </button>
                        </div>
                        <!-- Download Chart -->
                        <button type="button" class="download-btn" id="download-chart-btn" title="Télécharger le graphique">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="chart-title" style="text-align:center; font-weight:700; font-size:1.05rem; color:#1F2937; padding:0.5rem 0.75rem 0.25rem; font-family:Inter,sans-serif;"></div>
                    <canvas id="result-chart"></canvas>
                </div>
            </div>

            <!-- Data Table Card -->
            <div class="result-card table-card">
                <div class="card-header">
                    <i class="fas fa-table"></i>
                    <span>Données</span>
                    <div class="card-header-actions">
                        <button type="button" class="download-btn" id="download-csv-btn" title="Télécharger en CSV">
                            <i class="fas fa-file-csv"></i>
                        </button>
                        <button type="button" class="download-btn" id="download-excel-btn" title="Télécharger en Excel">
                            <i class="fas fa-file-excel"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-toolbar">
                        <div class="table-search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="table-search" placeholder="Filtrer par année..." autocomplete="off">
                        </div>
                        <div class="table-info">
                            <span id="table-row-count"></span>
                            <button type="button" class="table-sort-btn" id="table-sort-btn" title="Inverser l'ordre">
                                <i class="fas fa-sort-amount-down"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table id="result-table">
                            <thead>
                                <tr>
                                    <th class="sortable" data-col="year">Année <i class="fas fa-sort"></i></th>
                                    <th class="sortable" data-col="value">Valeur <i class="fas fa-sort"></i></th>
                                    <th>Variation</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Metadata Card -->
            <div class="result-card meta-card">
                <div class="card-header">
                    <i class="fas fa-info-circle"></i>
                    <span>Métadonnées</span>
                </div>
                <div class="card-body" id="result-source">
                </div>
            </div>

            <!-- Source Card -->
            <div id="source-card" class="result-card source-card" style="display:none;">
                <div class="card-header">
                    <i class="fas fa-link"></i>
                    <span>Source des données</span>
                </div>
                <div class="card-body">
                    <a id="source-card-link" href="#" target="_blank" rel="noopener noreferrer" class="source-detail-link" onclick="event.stopPropagation();">
                        <i class="fas fa-external-link-alt"></i>
                        <span id="source-card-text">Accéder à la source</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Recommendations -->
        <div id="recommendations-section" class="recommendations-section" style="display: none;">
            <h3><i class="fas fa-lightbulb"></i> Indicateurs similaires</h3>
            <div class="recommendations-grid" id="recommendations-container"></div>
        </div>
    </div>
</section>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/home-v2.js' %}?v=2.2"></script>
{% endblock %}
